@model IEnumerable<EnlightEnglishCenter.Models.KhoaHoc>
@{
    ViewData["Title"] = ViewBag.Title ?? "Lịch khai giảng";
}

<div class="container mt-4">
    <!-- 🏷️ TIÊU ĐỀ -->
    <h3 class="text-center text-primary fw-bold mb-4">
        <i class="fa-solid fa-calendar-days me-2"></i> @ViewData["Title"]
    </h3>

    <!-- 🗓️ NÚT CHUYỂN THÁNG -->
    <div class="text-center mb-4">
        <a href="/LichKhaiGiang/Index" class="btn btn-outline-primary btn-sm me-2">
            <i class="fa fa-calendar-day me-1"></i> Tháng này (@DateTime.Now.Month/@DateTime.Now.Year)
        </a>
        <a href="/LichKhaiGiang/ThangSau" class="btn btn-outline-success btn-sm">
            <i class="fa fa-calendar-plus me-1"></i> Tháng sau (@DateTime.Now.AddMonths(1).Month/@DateTime.Now.AddMonths(1).Year)
        </a>
    </div>

    @if (Model != null && Model.Any())
    {
        <table class="table table-bordered table-striped text-center align-middle shadow-sm">
            <thead class="table-primary">
                <tr>
                    <th>#</th>
                    <th>Tên khóa học</th>
                    <th>Trình độ</th>
                    <th>Ngày khai giảng</th>
                    <th>Thời lượng</th>
                    <th>Lịch học</th>
                    <th>Trạng thái</th>
                    <th>Đăng ký</th>
                </tr>
            </thead>
            <tbody>
                @{
                    int stt = 1;
                }
                @foreach (var item in Model)
                {
                    <tr>
                        <td>@(stt++)</td>
                        <td>@item.TenKhoaHoc</td>
                        <td>@(item.CapDo ?? "—")</td>
                        <td>@item.NgayBatDau?.ToString("dd/MM/yyyy")</td>
                        <td>@(item.ThoiLuong ?? "—")</td>
                        <td>
                            @if (item.NgayBatDau.HasValue && item.NgayKetThuc.HasValue)
                            {
                                @($"{item.NgayBatDau:dd/MM/yyyy} - {item.NgayKetThuc:dd/MM/yyyy}")
                            }
                            else
                            {
                                @("Chưa cập nhật")
                            }
                        </td>
                        <td>
                            @if (item.TrangThai == "Đang mở")
                            {
                                <span class="badge bg-success">Đang mở</span>
                            }
                            else if (item.TrangThai == "Đang học")
                            {
                                <span class="badge bg-info text-dark">Đang học</span>
                            }
                            else
                            {
                                <span class="badge bg-secondary">@item.TrangThai</span>
                            }
                        </td>
                        <td>
                            <a href="/TestDauVao/DangKy?maKhoaHoc=@item.MaKhoaHoc"
                               class="btn btn-outline-primary btn-sm">
                                <i class="fa fa-pen me-1"></i> Đăng ký Test
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        <!-- 🔽 NÚT XEM THÊM / THU GỌN -->
        <div class="text-center mt-3">
            @if (ViewBag.ShowAll == false && ViewBag.Total > 3)
            {
                <a href="/LichKhaiGiang/TatCa" class="btn btn-outline-primary btn-sm">
                    <i class="fa fa-list"></i> Xem tất cả (@ViewBag.Total)
                </a>
            }
            else if (ViewBag.ShowAll == true)
            {
                <a href="/LichKhaiGiang/Index" class="btn btn-outline-secondary btn-sm">
                    <i class="fa fa-chevron-up"></i> Thu gọn danh sách
                </a>
            }
        </div>
    }
    else
    {
        <div class="alert alert-info text-center">
            <i class="fa fa-info-circle me-2"></i>
            Không có khóa học nào đang mở trong thời gian này.
        </div>
    }
</div>
